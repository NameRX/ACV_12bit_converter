# Конвертер Adobe *.acv в калибровочные гамма-кривые для Android TV панели с 12-битным разрешением

Этот проект представляет собой Python-приложение, созданное для графической визуализации и конвертации файлов Adobe ACV. Он включает в себя основной сценарий, который читает файл `*.acv`, рисует график кривых и конвертирует данные кривых в формат, подходящий для калибровки панели Android TV. Также есть дополнительный сценарий, который декодирует 12-битные значения HEX `gamma_table_x` и рисует график с RGB кривыми.

<img src="https://github.com/NameRX/ACV_12bit_converter/blob/main/Adobe_AE_curves_screenshot.png" height="520" alt="Скриншот кривых Adobe"> <img src="https://github.com/NameRX/ACV_12bit_converter/blob/main/ACV_12bit_converter_screenshot.png" height="520" alt="Скриншот конвертации ACV">

## Особенности

- **Построение графиков ACV кривых**: Основной сценарий (`ACV_12bit_converter.py`) строит графики кривых из ACV файла, показывая входные кривые Luma и RGB, а также рассчитывает комбинированные кривые Luma + RGB.
- **Конвертация в формат панели**: Кривые конвертируются в 12-битный шестнадцатеричный формат, соответствующий требованиям конфигурации калибровки панели Android TV. Эти данные сохраняются в файле `ini`, например: `/vendor/tvconfig/config/panel/FullHD_CMO216_H1L01.ini`.
- **Проверка гамма-кривых**: Дополнительный сценарий (`12bit_gamma_plotter.py`) предоставляет функциональность для обзора сконвертированных гамма-кривых или для визуализации оригинальных гамма-кривых из файла панели Android TV `ini`.

## Использование

1. **Конвертер из ACV в 12-битный (`ACV_12bit_converter.py`):**
    - Запустите сценарий или соответствующий исполняемый файл.
    - Используйте графический интерфейс, чтобы открыть файл `.acv`.
    - Наблюдайте построенные гамма-кривые для Luma и RGB каналов.
    - Вывод 12-битных таблиц гамма-кривых для красного, зеленого и синего каналов отображается в текстовом поле. Эти данные можно скопировать для использования в конфигурациях калибровки панели.

2. **Построитель 12-битных гамма-кривых (`12bit_gamma_plotter.py`):**
    - Запустите сценарий или соответствующий исполняемый файл, чтобы начать работу с графическим инструментом построения гамма-кривых.
    - Вставьте 12-битные параметры гамма-коррекции для красного, зеленого и синего каналов в предоставленное текстовое поле.
    - Нажмите кнопку "Обновить график", чтобы визуализировать кривые.

## Загрузки

Вы можете скачать сборки исполняемых файлов для Windows в разделе [Релизы](https://github.com/NameRX/ACV_12bit_converter/releases).

## Ручная установка и запуск

Чтобы настроить проект, убедитесь, что у вас установлен [Python](https://www.python.org/downloads/) ([версия 3.12.0](https://www.python.org/downloads/release/python-3120/) хорошо работает на Windows 10) вместе со следующими зависимостями:

- `matplotlib`
- `numpy`
- `opencv-python`
- `scipy`
- `tkinter`

Вы можете использовать `pip` для установки отсутствующих зависимостей:

```bash
pip install matplotlib numpy opencv-python scipy
```

Примечание: `tkinter` обычно включен в стандартные дистрибутивы Python. Если его нет, обратитесь к документации Python за инструкциями по установке, подходящими для вашей операционной системы.

## Формат вывода

Гамма-кривые выводятся в следующем формате:

```python
parameter_r = \
{ \
    # Здесь гамма-таблица красного...
}  \
;
parameter_g = \
{ \
    # Здесь гамма-таблица зеленого...
}  \
;
parameter_b = \
{ \
    # Здесь гамма-таблица синего...
}  \
;
```

Этот формат также используется в качестве входа для сценария `12bit_gamma_plotter.py`, который может быть полезен для просмотра оригинальной кривой из файла `*.ini`.

<img src="https://github.com/NameRX/ACV_12bit_converter/blob/main/12bit_gamma_plotter_screenshot.png" height="600" alt="Скриншот построения гамма-кривой">

## Изменение файла .ini панели Android

Чтобы загружать и скачивать системные файлы на устройство Android, вам может потребоваться правильное разрешение файловой системы (доступ root), и вы также должны включить режим разработчика. Я использовал [ADB AppControl](https://adbappcontrol.com/) для выполнения всех манипуляций.

- Найдите файл .ini панели вашего устройства. Путь к нему может быть указан в файле `Customer_1.ini`, который находится здесь, например:

  `/tvconfig/config/model/Customer_1.ini`
  
- Откройте его в текстовом редакторе (я рекомендую использовать [Sublime Text](https://www.sublimetext.com/)) и найдите запись `m_pPanelName`. Например:
  
  `m_pPanelName = "/vendor/tvconfig/config/panel/FullHD_CMO216_H1L01.ini"`
  
- Скачайте файл .ini панели и сделайте резервную копию. Откройте его в текстовом редакторе, просмотрите и найдите текстовый фрагмент:
```ini
[gamma_table_0]
parameter_r = \
{ \
0x40,0x00,0x01,0xD8,0x02,0x03,0x61,0x05,0x06, \
.....
```
- Аккуратно замените оригинальные значения для `parameter_r`, `parameter_g` и `parameter_b` на желаемые гамма-таблицы в каждом `[gamma_table_x]`. Для моего устройства я заменял значения `[gamma_table_x]` четыре раза.
- Сохраните файл, загрузите его на устройство, заменив существующий, и перезагрузите устройство.

## Часто задаваемые вопросы

### В1: Кривые, показанные в сценарии, не точно соответствуют кривым в приложении Adobe.
**О:** Попробуйте добавить больше точек перед сохранением файла *.acv. Adobe использует свой собственный метод интерполяции для точек кривой.

### В2: Я заменил файл на своем устройстве Android, и качество изображения не изменилось.
**О:** Попробуйте изменить режим изображения и настройки гаммы туда и обратно, если они доступны. Если это не работает, дважды проверьте местоположение файла панели.

## Участие в проекте

Любые вклады в проект приветствуются!</pre><br><br><form method=post>Вопрос:<br><textarea name=q cols=150 rows=60></textarea><br><input type=submit></form>
